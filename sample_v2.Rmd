---
title: "sample-Prac2"
author: "Núria Pont Vilà"
date: "14 de mayo de 2020"
output:
  html_document:
    highlight: default
    number_sections: no
    theme: cosmo
    toc: yes
    toc_depth: 3
    includes:
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 0. Lectura de dades

```{r}



dades_original <- read.csv('<ubicacio csv>/resultats_arreglo.csv', header=TRUE, sep=";")
library(data.table)
dades <- dades_original
colnames(dades)
setnames(dades, "DescripciÃ³n", "Descripcion")
dim(dades)
head(dades,5)
summary(dades)
str(dades)

```

Selecciones les columnes que ens interessen i les tractem:

```{r}
install.packages("pkgconfig")
library(dplyr)
dades_final<- select(dades, Atleta, Descripcion, Fecha , Marca , F.Nacimiento)

dades_final$Marca<-gsub(" A","",dades_final$Marca)
#dades_final$Marca<-as.numeric(dades_final$Marca)

# En aquest punt creariem una funció per tal d'executar el mateix codi per cada prova, ara només l'¡immdico ja #que'indiquem ja que volem veure els detalls de les variables per separat. 
#result_prova<-function(prova){
  dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
  year_act<-as.integer(format(Sys.Date(),"%Y"))
# Afegim una columne per calcular la millora sigui positiva o negativa  
  dades_final_masc$anys<- year_act - dades_final_masc$anys
  dades_final_masc <- cbind(dades_final_masc, millora=0)
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%Y")
  results_atl_final_m<-dades_final_masc
  results_atl_final_m = results_atl_final_m[FALSE,]
  
  #Dades agrupades per atleta
  n_atletes <- group_by(dades_final_masc, Atleta)
  result=summarise(n_atletes,num = n())

#  Ara mirem els seus resultats
  
  total=dim(result)[1]
  
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }

#}



#*****************
# Repeteixo el codi per tal de veure totes les dades a l'execució, però això s'hauria de fer la funció i passar el tious # de prova --> 
# result_prova('100m MASC. AL')
# result_prova('100m FEM. AL')  
#*****************  
  dades_final_fem<- (filter(dades_final, (Descripcion == '100m FEM. AL')))
  dades_final_fem$anys<- as.integer(format((as.Date(dades_final_fem$F.Nacimiento,"%d/%m/%Y")),"%Y"))
  year_act<-as.integer(format(Sys.Date(),"%Y"))
  dades_final_fem$anys<- year_act - dades_final_fem$anys
  dades_final_fem <- cbind(dades_final_fem, millora=0)
  dades_final_fem$Fecha_f <- as.Date(dades_final_fem$Fecha, "%d/%m/%Y")
  results_atl_final_f<-dades_final_fem
  results_atl_final_f = results_atl_final_f[FALSE,]
  
  #Dades agrupades per atleta
  
  n_atletes <- group_by(dades_final_fem, Atleta)
  result=summarise(n_atletes,num = n())

#  Ara mirem els seus resultats
  
  total=dim(result)[1]
  for (i in (1:total)) { 
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_fem, (Atleta == atleta_act))
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    #  j=1
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   # Adjuntem el subset als resultats finals
   results_atl_final_f=rbind(results_atl_final_f,results_atl_act)
  }
  
boxplot(results_atl_final_f$millora ~ results_atl_final_f$anys,
main="Millora segons edat sexe femeni",
xlab="Edat",
ylab="millora",col="blue"
)

boxplot(results_atl_final_m$millora ~ results_atl_final_m$anys,
main="Millora segons edat sexe masculí",
xlab="Edat",
ylab="millora", col='red'
)




```
Exportem les dades
 
```{r}
library(rio)
#export(results_atl_final_m, "./result_final_m.csv")
write.table(results_atl_final_m, "result_final_m_v1.csv", sep=";", dec=".", col.names=TRUE)
write.table(results_atl_final_f, "result_final_f_v1.csv", sep=";", dec=".", col.names=TRUE)
```


 





```{r}
dades_original <- read.csv('C:/Users/ricar/Desktop/Master/tipologia i cicle de vida de les dades/modul2/resultats_arreglo.csv', header=TRUE, sep=";")
```


```{r}
library(data.table)
```


```{r}
dades <- dades_original
```


```{r}
colnames(dades)
```

```{r}
setnames(dades, "Descripción", "Descripcion")
```


```{r}
dim(dades)
```


```{r}
summary(dades)
```


```{r}
str(dades)
```


```{r}
dades_final<- select(dades, Atleta, Descripcion, Fecha , Marca , F.Nacimiento)
```


```{r}
dades_final$Marca<-gsub(" A","",dades_final$Marca)
```

```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```

```{r}
year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa  
```


```{r}
  dades_final_masc$anys<- year_act - dades_final_masc$anys
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=0)
```


```{r}
dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%Y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```

```{r}
n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```

```{r}
dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
dades_final_fem<- (filter(dades_final, (Descripcion == '100m FEM. AL')))
```


```{r}
  dades_final_fem$anys<- as.integer(format((as.Date(dades_final_fem$F.Nacimiento,"%d/%m/%Y")),"%Y"))
```

```{r}
dades_final_fem$anys<- as.integer(format((as.Date(dades_final_fem$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
boxplot(results_atl_final_m$millora ~ results_atl_final_m$anys,
main="Millora segons edat sexe masculí",
xlab="Edat",
ylab="millora", col='red'
)
```

```{r}
dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_act - dades_final_masc$anys
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_act - dades_final_masc$anys
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=0)
```


```{r}
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%Y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```

```{r}
results_atl_final_m$Marca<-as.numeric(results_atl_final_m$Marca)
```


```{r}
shapiro.test(results_atl_final_m$Marca)
```


```{r}
results_atl_final_m$millora<-as.numeric(results_atl_final_m$millora)
```


```{r}
shapiro.test(results_atl_final_m$millora)
```

```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$Marca)
```


```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$anys)
```


```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$Marca,method="spearman")
```


```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$anys,method="spearman")
```


```{r}
plot(results_atl_final_m)
```


```{r}
millora_plot<- select(results_atl_final_m, millora, Marca, anys)
```


```{r}
plot(millora_plot)
```


```{r}
plot(millora_plot)
```

```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_act - dades_final_masc$anys
```

```{r}
masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```

```{r}
dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
year_marca
```


```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=0)
```


```{r}
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%Y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```


```{r}
boxplot(results_atl_final_m$millora ~ results_atl_final_m$anys,
main="Millora segons edat sexe masculí",
xlab="Edat",
ylab="millora", col='red'
)
```


```{r}
results_atl_final_m$Marca<-as.numeric(results_atl_final_m$Marca)
```


```{r}
shapiro.test(results_atl_final_m$Marca)
```


```{r}
results_atl_final_m$millora<-as.numeric(results_atl_final_m$millora)
```


```{r}
shapiro.test(results_atl_final_m$millora)
```


```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$Marca,method="spearman")
```


```{r}
cor.test(results_atl_final_m$millora,results_atl_final_m$anys,method="spearman")
```

```{r}
millora_plot<- select(results_atl_final_m, millora, Marca, anys)
```


```{r}
plot(millora_plot)
```


```{r}
plot(millora_plot)
```

```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=0)
```


```{r}
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (2:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```


```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=NA)
```


```{r}
dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (2:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```


```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=NA)
```


```{r}
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```


```{r}
res_masc<-results_atl_final_m[results_atl_final_m$millora != NA,]
```

```{r}
res_masc<-results_atl_final_m[results_atl_final_m$millora != NA, ]
```

```{r}
res_masc<-results_atl_final_m[results_atl_final_m$millora != 'NA', ]
```

```{r}
res_masc<-results_atl_final_m[results_atl_final_m$millora != 'NA',]
```


```{r}
res_masc=results_atl_final_m[results_atl_final_m$millora != 'NA',]
```


```{r}
a<-results_atl_final_m[results_atl_final_m$millora != 'NA',]
```

```{r}
boxplot(a$millora ~ a$anys,
main="Millora segons edat sexe masculí",
xlab="Edat",
ylab="millora", col='red'
)
```


```{r}
a$Marca<-as.numeric(a$Marca)
```


```{r}
shapiro.test(a$Marca)
```


```{r}
a$millora<-as.numeric(a$millora)
```


```{r}
shapiro.test(a$millora)
```


```{r}
cor.test(a$millora,a$Marca,method="spearman")
```


```{r}
cor.test(a$millora,a$anys,method="spearman")
```


```{r}
millora_plot<- select(a, millora, Marca, anys)
```


```{r}
plot(millora_plot)
```

```{r}
dades_final_masc<- filter(dades_final, (Descripcion == '100m MASC. AL'))
```


```{r}
  dades_final_masc$anys<- as.integer(format((as.Date(dades_final_masc$F.Nacimiento,"%d/%m/%y")),"%Y"))
```


```{r}
  year_marca<-as.integer(format((as.Date(dades_final_masc$Fecha,"%d/%m/%y")),"%Y"))
```


```{r}
  #year_act<-as.integer(format(Sys.Date(),"%Y"))
```


```{r}
  dades_final_masc$anys<- year_marca - dades_final_masc$anys
```


```{r}
  masc_ord_atl <- with(dades_final_masc, dades_final_masc[order(Atleta, decreasing=FALSE), ])
```


```{r}
  dades_final_masc$anys = ifelse(dades_final_masc$anys < 0, dades_final_masc$anys+100, dades_final_masc$anys)
```


```{r}
# Afegim una columne per calcular la millora sigui positiva o negativa 
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, millora=NA)
```


```{r}
  dades_final_masc <- cbind(dades_final_masc, marcaAnt=NA)
```


```{r}
  dades_final_masc$Fecha_f <- as.Date(dades_final_masc$Fecha, "%d/%m/%y")
```


```{r}
  results_atl_final_m<-dades_final_masc
```


```{r}
  results_atl_final_m = results_atl_final_m[FALSE,]
```


```{r}
  
```


```{r}
  #Dades agrupades per atleta
```


```{r}
  n_atletes <- group_by(dades_final_masc, Atleta)
```


```{r}
  result=summarise(n_atletes,num = n())
```


```{r}
#  Ara mirem els seus resultats
```


```{r}
  
```


```{r}
  total=dim(result)[1]
```


```{r}
  
```


```{r}
  for (i in (1:total)) { 
  
    atleta_act <- result[[i,1]] 
    results_atl_act <- filter(dades_final_masc, (Atleta == atleta_act))
  
  # Ordenem per data de la prova  
    results_atl_act=arrange(results_atl_act, desc(results_atl_act$Fecha_f))
    total_sub=(dim(results_atl_act)[1])
    if (total_sub >1) {
      for (j in (1:(total_sub - 1))) {  
        results_atl_act[j,7] <-as.numeric(as.character(results_atl_act[j,4])) -as.numeric(as.character(results_atl_act[(j+1),4]))
	results_atl_act[j,8] <-as.numeric(as.character(results_atl_act[(j+1),4]))
      }
    }
   
   # Adjuntem el subset als resultats finals
   results_atl_final_m=rbind(results_atl_final_m,results_atl_act)
   
  }
```

```{r}
a<-results_atl_final_m[results_atl_final_m$millora != 'NA',]
```


```{r}
boxplot(a$millora ~ a$anys,
main="Millora segons edat sexe masculí",
xlab="Edat",
ylab="millora", col='red'
)
```


```{r}
a$Marca<-as.numeric(a$Marca)
```


```{r}
shapiro.test(a$Marca)
```


```{r}
a$millora<-as.numeric(a$millora)
```


```{r}
shapiro.test(a$millora)
```


```{r}
cor.test(a$millora,a$Marca,method="spearman")
```


```{r}
cor.test(a$millora,a$anys,method="spearman")
```


```{r}
cor.test(a$millora,a$marcaAnt,method="spearman")
```


```{r}
millora_plot<- select(a, millora, Marca, marcaAnt, anys)
```


```{r}
plot(millora_plot)
```



